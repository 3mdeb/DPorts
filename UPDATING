This file documents some of the problems you may encounter when upgrading
your ports.  We try our best to minimize these disruptions, but sometimes
they are unavoidable.

You should get into the habit of checking this file for changes each time
you update your ports collection, before attempting any port upgrades.

20211223:
  AFFECTS: users of security/bastillion
  AUTHOR: netchild@FreeBSD.org

  This update contains an incompatible DB change. Either recreate your
  DB (rm /usr/local/jetty_bastillion/bastillion/WEB-INF/classes/keydb/bastillion.*
  and restart) by hand, or export the old DB while the old version is
  installed and import the data into a new DB. See
    https://github.com/bastillion-io/Bastillion/issues/405
  for details.

20211220:
  AFFECTS: users of devel/notcurses
  AUTHOR: nickblack@linux.com

  Notcurses 3 introduces a new SONAME and significant API/ABI changes.
  Dependent applications must be recompiled at a minimum. A complete
  guide to updating for the new API is available under "Porting API2
  Applications to API3" at
  https://github.com/dankamongmen/notcurses/releases/tag/v3.0.0

20211220:
  AFFECTS: users of net-im/openfire
  AUTHOR: nikita@druba.su

  The port options have been renamed to be more readable.
  When not using the default options, they have to be regenerated.

  # cd /usr/ports/net-im/openfire
  # make config

20211213:
  AFFECTS: users of emulators/qemu-utils
  AUTHOR: bofh@FreeBSD.org

  New port emulators/qemu@tools has been introduced which is similar to
  emulators/qemu-utils. qemu-utils has also been DEPRECATED in favor for
  this as it's MASTER port has also been marked DEPRECATED and set to
  expire on 2022-01-09. For updating to qemu-tools please use one of
  the following command:

  # pkg install qemu-tools
    or
  # portmaster -o emulators/qemu-utils emulators/qemu@tools

20211116:
  AFFECTS: users of emulators/qemu50
  AUTHOR: bofh@FreeBSD.org

  emulators/qemu50 has been moved to emulators/qemu5 and updated to 5.2.0 
  which is the last version from 5.X.X branch. This is done in preparation
  of updating emulators/qemu into latest 6.X bgranch. If someone wants to
  stick with 5.X.X branch please use one of the following command:

  # pkg install qemu5
    or
  # portmaster -o emulators/qemu50 emulators/qemu5

  This version also introduces a stripped nox11 version which can be
  installed with:
  # pkg install qemu5-nox11
   or
  # portmaster emulators/qemu5@nox11

20211115:
  AFFECTS: AFFECTS: users of *-emacs2x-* packages
  AUTHOR: jrm@FreeBSD.org

  To avoid problems when editors/emacs or editors/emacs-devel are
  updated, the emacs major version has been removed from these package
  names.

  For example, the old and new package names of devel/magit are

  -----------------------------------------------------------
  | Old Package Name          | New Package Name            |
  |-------------------------- |-----------------------------|
  | magit-emacs27             | magit                       |
  | magit-emacs27_nox         | magit-emacs_nox             |
  | magit-emacs27_canna       | magit-emacs_canna           |
  |                           |                             |
  | magit-emacs29_nox         | magit-emacs_devel_nox       |
  | magit-emacs29             | magit-emacs_devel           |
  -----------------------------------------------------------

  To handle these final package name changes, follow a similar procedure
  as the one described in the 20200811 entry.  That is, simply running
  `pkg upgrade` will not upgrade, e.g., foo-emacs27_nox to
  foo-emacs_nox.

  Binary package users:

  To update these packages, run these commands under /bin/sh with superuser
  privileges before upgrading.

  # default flavor of editors/emacs installed
  for i in $(pkg query -g %n '*-emacs27'); do
    if [ "$i" != "notmuch-emacs27" ]; then
      nn=$(echo "$i" | sed -e 's/-emacs27//')
    else
      nn=$(echo "$i" | sed -e 's/-emacs27/-emacs/')
    fi
    pkg set -yn "$i":"$nn"
  done

  # canna or nox flavor of editors/emacs installed
  for i in $(pkg query -g %n '*-emacs27*'); do
    nn=$(echo "$i" | sed -e 's/emacs27/emacs/')
    pkg set -yn "$i":"$nn"
  done

  # editors/emacs-devel installed
  for i in $(pkg query -g %n '*-emacs29*'); do
    nn=$(echo "$i" | sed -e 's/emacs29/emacs_devel/')
    pkg set -yn "$i":"$nn"
  done

  portmaster users:

  portmaster -r emacs

20211110:
  AFFECTS: users of www/node*, www/npm*, www/yarn*
  AUTHOR: mfechner@FreeBSD.org

  The port framework was updated to use a default version for nodejs.
  The default version is pointing to the latest LTS version which is
  currently version 16.
  You can overwrite this by defining in /etc/make.conf, e.g. version 17:
  DEFAULT_VERSIONS=nodejs=17

  Or if you would like to stick always to the current version use:
  DEFAULT_VERSIONS=nodejs=current

  If you would like to use yarn or npm together with nodejs version 17,
  just install the package that is pulling the wanted dependency to nodejs:

  # pkg install yarn-node17
  # pkg install npm-node17

20211109:
  AFFECTS: users of security/libressl
  AUTHOR: brnrd@FreeBSD.org

  The port has been updated to the latest stable version 3.4 of LibreSSL.
  The shared library versions of the libraries have been bumped.

  After upgrading, manually update all packages that depend on any of the
  libraries provided by LibreSSL (libssl, libcrypto and libtls) since the
  versions of these libraries have changed. Normally, you can obtain the
  list of dependent software by running the following command:

  # pkg info -r libressl

  Then you should rebuild all ports depending on libressl to avoid dangling
  shared library dependencies.

20211107:
  AFFECTS: users of sysutils/devcpu-data
  AUTHOR: jrm@FreeBSD.org

  The RC variable name microcode_cpus is now deprecated.  Users should
  instead use the variable microcode_update_cpus.

  Two new ports were branched from sysutils/devcpu-data,
  sysustils/devcpu-data-amd and sysustils/devcpu-data-intel.  The two
  new ports contain only the CPU microcode updates for each vendor and
  sysutils/devcpu-data now only contains an RC script.  Both new ports
  are on-by-default, optional dependencies of sysutils/devcpu-data.

20211101:
  AFFECTS: users of textproc/redisearch
  AUTHOR: osa@FreeBSD.org

  The textproc/redisearch port has been updated to the recent stable
  release - v2.2.  Users wanting to stay on v2.0 can replace
  textproc/redisearch with textproc/redisearch20 with one of the
  following commands:

  # pkg install textproc/redisearch20
    or
  # portmaster -o textproc/redisearch20 textproc/redisearch
    or
  # portupgrade -o textproc/redisearch20 textproc/redisearch

  NOTE: The textproc/redisearch20 brings a new name for the module,
  i.e. redisearch20.so, so be careful.

20211024:
  AFFECTS: sysutils/beats7
  AUTHOR: otis@FreeBSD.org

  The following breaking changes apply to beats 7.15.0 and newer:

    - All beats:
    Loading Kibana assets (dashboards, index templates) rely on Saved Object API.
    So to provide a reliable service, Beats can only import and export dashboards
    using at least Kibana 7.15.

    - Filebeat:
      - Remove all alias fields pointing to ECS fields from modules. This affects
        the Suricata and Traefik modules.
      - Fix Crowdstrike ingest pipeline that was creating flattened process fields.
      - Rename log.path to log.file.path in filestream to be consistent with log
        input and ECS.

    - Heartbeat:
      - Remove long deprecated watch_poll functionality.
      - Fix inconsistency in event.dataset values between heartbeat and fleet by
        always setting this value to the monitor type / fleet dataset.

    - Metricbeat:
      - Fix Elasticsearch jvm.gc.collectors.old being exposed as young

  Full changelog:
    https://www.elastic.co/guide/en/beats/libbeat/current/release-notes-7.15.0.html
    https://www.elastic.co/guide/en/beats/libbeat/current/release-notes-7.15.1.html

20211024:
  AFFECTS: users of databases/postgresql* and other software using PostgreSQL to run
  AUTHOR: kbowling@FreeBSD.org

  The default version of PostgreSQL has been switched from 12 to 13.
  The upgrade procedure can use up twice the space the databases
  currently needs. If you have a big amount of stored data take a
  closer look at the manpage of pg_upgrade for avoidance and/or
  speedup of the upgrade.

  The upgrade instructions consider a basic usage and do not match
  complex scenarios like replication, sharding, or similar.

  Upgrade instructions:

  First stop your PostgreSQL, create PostgreSQL-binaries and backup your data.
  If you have another Version of PostgreSQL installed, for example 12.8, your
  files are named according to this.

  # service postgresql stop
  # pkg create postgresql12-server postgresql12-contrib
  # mkdir /tmp/pg-upgrade
  # tar xf postgresql12-server-12.8.pkg -C /tmp/pg-upgrade
  # tar xf postgresql12-contrib-12.8.pkg -C /tmp/pg-upgrade
  # pkg delete -f databases/postgresql12-server databases/postgresql12-contrib databases/postgresql12-client

  Now update PostgreSQL:

    pkg user:
    # pkg install databases/postgresql13-server databases/postgresql13-contrib
    # pkg upgrade

    Portmaster users:
    # portmaster databases/postgresql13-server databases/postgresql13-contrib
    # portmaster -a

    Portupgrade users:
    # portinstall databases/postgresql13-server databases/postgresql13-contrib
    # portupgrade -a

  After installing the new PostgreSQL version you need to convert
  all your databases to new version:

  # su -l postgres -c "/usr/local/bin/initdb --encoding=utf-8 --lc-collate=C -D /var/db/postgres/data13 -U postgres"
  # su -l postgres -c "pg_upgrade -b /tmp/pg-upgrade/usr/local/bin/ -d /var/db/postgres/data12/ -B /usr/local/bin/ -D /var/db/postgres/data13/ -U postgres "

  Now the migration is finished. You can start PostgreSQL again with:

  # service postgresql start

  ATTENTION:
  1) The default user changed from "pgsql" to "postgres" in 11. The migration steps above now assume
     the "postgres" database user and FreeBSD user.
  2) See the updating entry 20190829 if you are updating from a release prior to 11.
  3) If you use non-default initdb options, you have to adjust the initdb-command accordingly

20211023:
  AFFECTS: users of www/node
  AUTHOR: bhughes@FreeBSD.org

  The www/node port has been updated to Node.js v17.0.0, the latest
  upstream release. A new port, www/node16, has been created for the
  upcoming v16.x LTS branch. Users wanting to stay on v16.x can replace
  www/node with www/node16 with one of the following commands:

  # pkg install www/node16
    or
  # portmaster -o www/node16 www/node
    or
  # portupgrade -o www/node16 www/node

20211012:
  AFFECTS: users of devel/git
  AUTHOR: garga@FreeBSD.org

  devel/git port was split into multiple sub-ports that depend on devel/git
  and install additional files:

  - devel/git-cvs - CVS related scripts and man pages
  - devel/git-gui - GUI related scripts and man pages
  - devel/git-p4  - Perforce related scripts and man pages
  - devel/git-svn - Subversion related scripts and man pages

  Due to these changes, CVS, GUI, PERFORCE, and SUBVERSION options
  as well as gui and svn flavors were removed from the port.

20211010:
  AFFECTS: users of gtk2 flavored devel/geany*
  AUTHOR: madpilot@FreeBSD.org

  Upstream dropped support for gtk2. Due to this the ports are now
  unflavored, installing only with gtk3 support.

  If you are already using the default gtk3 flavor will get the new
  version with a simple "pkg upgrade".

  To upgrade when using the gtk2 flavors you need to use "pkg install"
  to install the new unflavored gtk3 packages, pkg will automatically
  uninstall the old gtk2 flavors.

  If using ports, you will need to uninstall all geany packages and
  its plugins and reinstall from an updated ports tree.

  The "geany-plugin-multiterm" plugin was only available as a gtk2
  flavor when installing the gtk2 flavor of geany and has not been
  ported to gtk3, so has been removed from the tree, so the
  geany-plugin-multiterm-gtk2 package should be removed from the system.

20211007:
  AFFECTS: user of security/clamav
  AUTHOR: yasu@FreeBSD.org

  Upstream changed end-of-life policy and introduced long time support
  (LTS) feature release.

  * LTS feature release will be identified approximately every two
    years and supported for at least three years from the initial
    publication date of that LTS feature version.
  * Regular (non-LTS) feature releases will be supported for at least
    four months from the initial publication date of the next feature
    release or until the feature release after that is published.

  According to it new port security/clamav-lts is added for users who
  want to use LTS version of ClamAV.

  Users wanting to switch to LTS version can replace security/clamav
  with security/clamav-lts with one of following commands.

  If you use pkg with binary packages:
    # pkg set -o security/clamav:security/clamav-lts
    # pkg upgrade
  If you use portmaster:
    # portmaster -o security/clamav-lts security/clamav
  If you use portupgrade:
    # portupgrade -o security/clamav-lts security/clamav

20211006:
AFFECTS: users of misc/freebsd-doc-*
AUTHOR: blackend@FreeBSD.org

The misc/freebsd-doc-* ports have been updated to the new doc toolchain,
and use a somewhat different arrangement of directories and symlinks,
which pkg 1.17 does not handle well.

Users are encouraged to delete the misc/freebsd-doc-* ports, then
reinstall the new ones without using the pkg upgrade facility.

20211006:
  AFFECTS: users of net/kafkacat
  AUTHOR: sergey@akhmatov.ru

  kafkacat has been renamed to kcat upstream.
  So switch to net/kcat instead.

20211004:
  AFFECTS: users of net-mgmt/netbox
  AUTHOR: kai@FreeBSD.org

  /!\ WARNING /!\

  The NetBox 3.0 release contains major changes, so at least items 1.), 2.)
  and 3.) must be checked before proceeding with the upgrade!

  /!\ WARNING /!\

  1. Please ensure that your local installation of net-mgmt/netbox is at
     the 2.11 release before attemping to upgrade to NetBox 3.0 or later.

  2. Please also note that the previously deprecated secrets functionality
     has been removed with NetBox 3.0.  This means, all of the secrets still
     remain in the database once upgraded, only the secrets functionality on
     the part of NetBox is no longer given.

     In order to continue to be able to access the stored secrets as usual
     (and then possibly migrate them to another solution, e.g.
     security/vault), please install the security/py-netbox-secretstore port
     once NetBox has been upgraded to 3.x and follow its installation
     instructions how to enable the plugin.

  3. If plugins are used, they should be temporarily deactivated to avoid
     disruptions during the upgrade process.

  4. Please also check the pkg-message and the changelogs for further info.

20211004:
  AFFECTS: users of www/py-pyjwt
  AUTHOR: rhurlin@FreeBSD.org

  To make it possible to easily import py-pyjwt v2.x the current port was
  moved to a versioned directory.

  If you use portmaster:
        portmaster -o www/py-pyjwt1 www/py-pyjwt
  If you use portupgrade:
        portupgrade -fo www/py-pyjwt1 www/py-pyjwt
  If you use pkg with binary packages:
        pkg set -o www/py-pyjwt:www/py-pyjwt1

20210912:
  AFFECTS: x11-wm/cage, x11-wm/hikari, x11-wm/labwc, x11-wm/sway, x11-wm/wayfire
  AUTHOR: jbeich@FreeBSD.org

  SUID option has been removed in favor of seatd-launch(1) which doesn't
  require special handling in every consumer and doesn't bypass group
  permissions. If you've already enabled seatd service or use consolekit2
  then nothing changes. Otherwise,

    $ sway
    00:00:00.001 [ERROR] [wlr] [libseat] [libseat/libseat.c:83] No backend was able to open a seat
    00:00:00.001 [ERROR] [wlr] [backend/session/session.c:84] Unable to create seat: Function not implemented
    00:00:00.001 [ERROR] [wlr] [backend/session/session.c:218] Failed to load session backend
    00:00:00.001 [ERROR] [wlr] [backend/backend.c:353] Failed to start a DRM session
    00:00:00.001 [ERROR] [sway/server.c:53] Unable to create backend

  can be fixed by

    $ ck-launch-session sway

  or

    $ seatd-launch sway

  or

    # sysrc seatd_enable=YES
    # service seatd start
    $ sway

  Replace "sway" with your compositor e.g., "cage", "hikari", "labwc", "wayfire".

20210907:
  AFFECTS: consumers of math/eigen[23]
  AUTHOR: adridg@FreeBSD.org

  math/eigen2 has been marked deprecated. There do not seem to be any
  consumers in FreeBSD ports.

  math/eigen3 has had its options re-vamped. The default options previously
  pulled in multiple useless library dependencies. The options also forced
  a specific BLAS implementation. The new options depend only on the
  default BLAS (whatever USES=blaslapack picks), but this can be turned
  off. The previous multiple useless libraries -- which are not useless
  when running the tests in Eigen -- are now hidden behind the default-off
  TEST option.

  Users of a carefully-tuned Eigen build should re-evaluate the options
  available.

20210902:
  AFFECTS: users of editors/vim
  AUTHOR: adamw@FreeBSD.org

  The vim ports have been completely reworked to take advantage of flavors.

  The biggest change is that the `vim' package is now console-only. If
  you want the GTk3 GUI, you'll need to install the `vim-gtk3' package
  instead. All the GUI toolkits have their own package now: vim-gtk3,
  vim-gtk2, -athena, -motif, and -x11. The vim-tiny package still exists.

  Also: only python3 bindings are included now. There are very few plugins
  written in Perl or Ruby, so there really wasn't a need to bundle those
  languages with Vim. They still exist as OPTIONS, so you can still enable
  them if you'd like. Also, support for py27 has been dropped.

20210901:
  AFFECTS: users of audio/ampache
  AUTHOR: crees@FreeBSD.org

  With the upgrade to Ampache 5.0.0, the root Ampache folder has changed
  to %%WWWDIR%%/ampache/public.  Please update your web server aliases,
  for example if you use Apache, then in httpd.conf make sure the lines
  look like this:

  Alias /ampache /usr/local/www/ampache/public

  <Directory "/usr/local/www/ampache/public">

  If you have customised your .htaccess files to allow for a different
  alias, you'll need to move them to the new location after upgrading:

  # sh -c 'cd /usr/local/www/ampache && for f in */.htaccess; do mv $f public/$f; done'

  More upgrade notes can be found on Github:

  https://github.com/ampache/ampache/releases/tag/5.0.0

20210823:
  AFFECTS: users of mail/mu
  AUTHOR: hrs@FreeBSD.org

  mail/mu now uses XDG Base Directory Specification for the default
  locations for various files.  The mu database now lives under
  ~/.cache/mu rather than ~/.mu by default.  After upgrading,
  move the contents under ~/.mu to ~/.cache/mu.

20210823:
  AFFECTS: users of mail/postfixadmin
  AUTHOR: ports.maintainer@evilphi.com

  The 3.2->3.3 upgrade requires generating a new setup password hash.
  The normal post-upgrade visit to setup.php will walk you through the
  steps.

  For more information, see the "Version 3.3" section of the change log:
  https://github.com/postfixadmin/postfixadmin/blob/postfixadmin-3.3.9/CHANGELOG.TXT

20210818:
  AFFECTS: users of databases/redis
  AUTHOR: osa@FreeBSD.org

  The databases/redis port has been updated to the recent stable release.
  Users wanting to stay on v6.0 can replace databases/redis with
  databases/redis6 with one of the following commands:

  # pkg install databases/redis6
    or
  # portmaster -o databases/redis6 databases/redis
    or
  # portupgrade -o databases/redis6 databases/redis

20210805:
  AFFECTS: users of sysutils/beats7
  AUTHOR: otis@FreeBSD.org

  Beats may not be sending data to some distributions of Elasticsearch

  In this release, Elastic is enabling a licensing change that was broadly
  communicated earlier in 2021. This change would imply that 7.13 instances of
  Beats would fail to connect to 7.10 or earlier open source distributions of
  Elasticsearch and Kibana.

  The most visible effect is that sysutils/beats7 users can expect
  difficulties to send data to Elastic instances hosted in AWS.

  For more information, see:
  https://www.elastic.co/guide/en/beats/libbeat/current/breaking-changes-7.13.html

20210801:
  AFFECTS: users of OpenLDAP
  AUTHOR: delphij@FreeBSD.org

  SASL is now always enabled for OpenLDAP.

  If you use portmaster:
        portmaster -o net/openldap24-client openldap-sasl-client
  If you use portupgrade:
	portupgrade -fo net/openldap24-client openldap-sasl-client
  If you use pkg with binary packages:
        pkg set -o net/openldap24-sasl-client:net/openldap24-client

20210730:
  AFFECTS: users of multimedia/mlt, multimedia/mlt-qt and multimedia/py-mlt
  AUTHOR:  kde@FreeBSD.org

  multimedia/{py-,}mlt{-qt5,} has been moved to multimedia/{py-,}mlt6{-qt5,}
  to make room for importin the next major version of the mlt framework.

20210721:
  AFFECTS: users of x11/rxvt-unicode
  AUTHOR: thierry@FreeBSD.org

  Since 9.26, there is a regression in resource parsing, which no longer
  accepts a prefix of the form "URxvt*keysym" ("*." is equivalent to "*").

  Changing "*." to "." should make your bindings work again.

20210704:
  AFFECTS: users of misc/qtchooser
  AUTHOR: kde@FreeBSD.org

  QtChooser allows you to select your version of Qt among those installed.
  However, this tool is no longer supported upstream and will not be
  available for Qt6.

  By default, our Qt installations are done in:
  ${LOCALBASE}/lib/qt${QT_VERSION} as recommended.
  We have added symbolic linking for the main binaries to 
  ${LOCALBASE}/bin with the suffix -qt5.

20210628:
  AFFECTS: users of misc/openhab
  AUTHOR: netchild@FreeBSD.org

  You need to run
    sed -i -e 's:^karaf.framework.equinox=.*:karaf.framework.equinox=mvn\:org.eclipse.platform/org.eclipse.osgi/3.16.200: ; s:^karaf.framework.felix=.*:karaf.framework.felix=mvn\:org.apache.felix/org.apache.felix.framework/6.0.4:' /var/db/openhab/userdata/etc/config.properties
  to update the version numbers of some components in a config file.

20210621:
  AFFECTS: users of www/gitlab-ce
  AUTHOR: mfechner@FreeBSD.org

  The upgrade of Gitlab 14.0.0 is in preparation.
  You must upgrade first to 13.12.
  For more information see here:
  https://about.gitlab.com/blog/2021/06/04/gitlab-moving-to-14-breaking-changes/

  To do the upgrade, make sure you follow the upgrade manuals:
  https://gitlab.fechner.net/mfechner/Gitlab-docu/-/tree/master/update

  I will merge the 14.0.0 upgrade later to quarterly branch to give you
  some time for the upgrade to 13.12.

20210620:
  AFFECTS: users of misc/openhab2
  AUTHOR: netchild@FreeBSD.org

  The openhab v3 port has been committed. Upstream has removed the
  version from the name, as such the FreeBSD port follows in all places
  (start script name, directory names, ...).
  Users are encouraged to migrate from misc/openhab2 to misc/openhab.

  No automatic config migration is available Both versions can be
  installed in parallel, but an users has to take care to not run
  both at the same time on the same port.

20210617:
  AFFECTS: users of graphics/mesa-libs and x11/nvidia-driver
  AUTHOR: kbowling@FreeBSD.org

  Some libraries from mesa-libs are now provided by libglvnd while
  others were renamed. nvidia-driver already used libglvnd but bundled
  a copy which is now provided as a separate package. When building
  outside poudriere make sure to remove mesa-libs and nvidia-driver
  first in order to avoid conflict with libglvnd.

  For portmaster users:
  # pkg delete -f mesa-libs nvidia-driver
  # portmaster -a

  For portupgrade users:
  # pkg delete -f mesa-libs nvidia-driver
  # portupgrade -a

20210523:
  AFFECTS: users of www/tt-rss
  AUTHOR: dereks@lifeofadishwasher.com

  tt-rss config.php syntax has changed.  You can find detailed changes
  here https://tt-rss.org/wiki/GlobalConfig or look at config.php.sample.
  Expect your config.php to not work with newer www/tt-rss releases.

  Due to changes in ttrssd before updating you should stop ttrssd or
  otherwise kill the php process running update_daemon2.php.

20210516:
  AFFECTS: users of security/bitwarden_rs
  AUTHOR: mr@FreeBSD.org

  bitwarden_rs has been renamed to vaultwarden upstream.
  So switch to security/vaultwarden instead.

20210515:
  AFFECTS: users of databases/postgresql??-server
  AUTHOR: girgen@FreeBSD.org

  The rc.conf parameter for the login class of the postgresql daemon has
  changed name from postgresql_class to postgresql_login_class.
  rc.subr(8) states that the parameter should be named ${name}_login_class.

